/*! editTable v0.1.0 by Alessandro Benoit */
(function(e,t,n){"use strict";e.fn.editTable=function(t){function h(e){e=e===0?"0":(e||"").toString();return'<td><input type="text" name="" value="'+e.replace(/"/g,"&quot;")+'" /></td>'}function p(t,n){var r="",i;t=t||"";for(i=0;i<(n||t.length);i+=1){r+=h(t[i])}return e("<tr/>",{html:r+'<td><a class="addrow icon-button" href="#">+</a> <a class="delrow icon-button" href="#">-</a></td>'})}function d(){if(f<2){u.find(".delcol").addClass("disabled")}if(l<2){u.find(".delrow").addClass("disabled")}if(r.maxRows&&l===r.maxRows){u.find(".addrow").addClass("disabled")}}function v(e){var t,n=Math.min(r.maxRows,e.length);u.html(o);if(r.headerCols){for(t=0;t<r.headerCols.length;t+=1){u.find("thead tr").append("<th>"+r.headerCols[t]+"</th>")}for(t=0;t<n;t+=1){p(e[t],r.headerCols.length).appendTo(u.find("tbody"))}}else{for(t=0;t<e[0].length;t+=1){u.find("thead tr").append(a)}for(t=0;t<n;t+=1){p(e[t]).appendTo(u.find("tbody"))}}u.find("thead tr").append("<th></th>");f=u.find("thead th").length-1;l=u.find("tbody tr").length;d()}function m(){var t=0,n=[];u.find("tbody tr").each(function(){t+=1;n[t]=[];e(this).find("input").each(function(){n[t].push(e(this).val())})});n.splice(0,1);return n}var r=e.extend({name:"",data:[[""]],jsonData:false,headerCols:false,maxRows:999},t),s=e(this),o="<thead><tr></tr></thead><tbody></tbody>",u=e("<table/>",{"class":"inputtable"+(!r.headerCols?" wh":""),html:o}),a='<th><a class="addcol icon-button" href="#">+</a> <a class="delcol icon-button" href="#">-</a></th>',f,l,c;n=n+1;if(s.is("textarea")){c=JSON.parse(s.val());s.after(u);if(u.parents("form").length>0){u.parents("form").submit(function(){s.val(JSON.stringify(m()))})}}else{c=JSON.parse(r.jsonData)||r.data;s.append(u)}v(c);u.on("click",".addcol",function(){var t=parseInt(e(this).parents("tr").children().index(e(this).parent("th")),10);f+=1;u.find("thead tr").find("th:eq("+t+")").after(a);u.find("tbody tr").each(function(){e(this).find("td:eq("+t+")").after(h())});u.find(".delcol").removeClass("disabled");return false});u.on("click",".delcol",function(){if(e(this).hasClass("disabled")){return false}var t=parseInt(e(this).parents("tr").children().index(e(this).parent("th")),10);f-=1;d();e(this).parent("th").remove();u.find("tbody tr").each(function(){e(this).find("td:eq("+t+")").remove()});return false});u.on("click",".addrow",function(){if(e(this).hasClass("disabled")){return false}l+=1;e(this).parents("tr").after(p(0,f));u.find(".delrow").removeClass("disabled");d();return false});u.on("click",".delrow",function(){if(e(this).hasClass("disabled")){return false}l-=1;d();e(this).parents("tr").remove();u.find(".addrow").removeClass("disabled");return false});u.on("click","input",function(){e(this).select()});return{getData:function(){return m()},getJsonData:function(){return JSON.stringify(m())},loadData:function(e){v(e)},loadJsonData:function(e){v(JSON.parse(e))},reset:function(){v(c)}}}})(jQuery,this,0)